import{r as m,S as E,M as d,j as e,C as R,R as G,a as _,f as F,b as T,D as L,I as B,c as J,v as A,i as V,d as O,e as U,g as K,h as X,B as P,k as Z,l as ee,m as ae,P as te,F as se,n as re,H as oe,Q as le,o as ne,p as ce}from"./index-BKMvGpez.js";const ue=()=>{const{setVisibleModal:c,visibleModal:i,selectedSchoolUUID:o}=m.useContext(E),[x,p]=m.useState(!1),u=m.useRef({}),[v,l]=m.useState([[],[]]),r=()=>{c(0),d.destroyAll()};return m.useEffect(()=>{const n=async()=>{const h=await _.getSchoolByUUID(o);u.current[o]=[[{label:"School Name",value:h.school_name},{label:"Address",value:h.school_address},{label:"Contact",value:F(h.phone_number)}],[{label:"Start",value:h.start_member,type:"date"},{label:"End",value:h.end_member,type:"date"}]],l(u.current[o])};if(o)if(u.current[o])p(!0),l(u.current[o]),p(!1);else{p(!0);try{n()}catch{d.error({title:"Error fetching school details",content:"Failed to fetch school details",centered:!0}),p(!1)}}},[o,v]),e.jsx(d,{title:"Detail School",open:i,onCancel:r,footer:null,centered:!0,children:x?e.jsx("p",{children:"Loading..."}):e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-3",children:[v[0].map((n,h)=>e.jsxs(R,{className:"flex flex-col",children:[e.jsx("p",{children:e.jsxs("strong",{children:[n.label," :"]})}),e.jsx("p",{children:n.value})]},h)),e.jsx(G,{children:v[1].map((n,h)=>e.jsxs(R,{span:12,children:[e.jsx("p",{children:e.jsxs("strong",{children:[n.label," :"]})}),e.jsx("p",{children:n.value})]},h))})]})})})},Y={required:{value:!0,message:"*This field must be filled"},minLength:{value:3,message:"School Name should not be less than 3 characters"},maxLength:{value:50,message:"School Name should not exceed 50 characters"}},q={required:{value:!0,message:"*This field must be filled"},minLength:{value:3,message:"School Address should not be less than 3 characters"},maxLength:{value:100,message:"School Address should not exceed 50 characters"}},$={required:{value:!0,message:"*This field must be filled"},pattern:{value:/^08\d{8,13}$/,message:"*Please enter only 10-15 numbers"}},H={required:{value:!0,message:"*This field must be filled"}},z={required:{value:!0,message:"*This field must be filled"}},Q=({schoolValidations:c})=>{const[i,o]=m.useState([{label:"School Name",name:"school_name",type:"text",placeholder:"School Name",required:!0,isError:!1,errorMessage:null,value:"",validations:c.schoolNameValidations},{label:"School Address",name:"school_address",type:"text",placeholder:"Address",required:!0,isError:!1,errorMessage:null,value:"",validations:c.schoolAddressValidations},{label:"Contact",name:"phone_number",type:"number",placeholder:"Contact",required:!0,isError:!1,errorMessage:null,value:"",validations:c.phoneNumberValidations},{label:"Start",name:"start_member",type:"date",placeholder:"Select Date",isError:!1,errorMessage:null,value:"",validations:c.startMemberValidations},{label:"End",name:"end_member",type:"date",placeholder:"Select Date",isError:!1,errorMessage:null,value:"",validations:c.endMemberValidations}]);return{formData:i,setFormData:o}},de=()=>{const{visibleModal:c,setVisibleModal:i,setIsTableLoading:o,setIsRefreshPage:x}=m.useContext(E),p={schoolNameValidations:Y,schoolAddressValidations:q,phoneNumberValidations:$,startMemberValidations:H,endMemberValidations:z},{formData:u,setFormData:v}=Q({schoolValidations:p}),[l,r]=m.useState(!0),n=(t,b)=>{v(D=>{const f=D.map(a=>{const{errorMessage:s,isError:g}=A(a.validations,t,b);return a.name==b?{...a,isError:g,value:t,errorMessage:s}:a});return r(!V(u,f)),f})},h=t=>{let{name:b,value:D}=t.target;v(f=>{const a=f.map(s=>{const{errorMessage:g,isError:j}=A(s.validations,D,b),S=b==="phone_number"?F(D):D;return s.name==b?{...s,value:S,errorMessage:g,isError:j}:s});return r(!V(u,a)),a})},I=async()=>{M();try{o(!0);const t=u.reduce((b,D)=>{const{value:f,name:a}=D,s=D.name==="phone_number"?O(f):f;return b[a]=s,b},{});await _.createSchool(t),d.success({title:"Create School Data",content:"Data added successfully!",centered:!0,onOk:M})}catch(t){const b=t.response;d.error({title:"Create School Data",content:b.message,centered:!0,onOk:M})}finally{o(!1),x(t=>!t)}},y=t=>{t.preventDefault(),d.info({title:"Create School",content:"Are you sure the data correct?",okCancel:!0,onOk:I,centered:!0})},N=t=>{t.preventDefault(),d.warning({title:"Create School",content:"Are you sure you want to exit? The data will not be saved.",okCancel:!0,centered:!0,onOk:M,width:500})},M=()=>{i(0),d.destroyAll()};return e.jsx(d,{title:"Create School",open:c,onCancel:N,onOk:y,okButtonProps:{disabled:l},centered:!0,children:e.jsx("form",{className:"flex flex-col gap-3",children:u.map((t,b)=>t.type=="date"?e.jsxs(T,{direction:"vertical",className:"w-full text-black/90",children:[e.jsxs("label",{htmlFor:t.name,children:[e.jsx("span",{className:"text-errorHover",children:"*"})," ",t.label]}),e.jsx(L,{className:"w-full text-black/90",format:"YYYY/MM/DD",name:t.name,placeholder:t.placeholder,onChange:(D,f)=>n(f,t.name),required:!0}),t.errorMessage&&e.jsx("span",{className:"text-errorBase",children:t.errorMessage})]},b):e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("h3",{className:"text-lg text-black/0.88",children:[e.jsx("span",{className:"text-errorHover",children:"*"})," ",t.label]}),e.jsx(B,{type:"text",id:t.name,name:t.name,placeholder:t.placeholder,value:t.value,onChange:h,suffix:e.jsx(J,{className:`text-errorBase ${t.isError?"block":"hidden"}`})}),t.errorMessage&&e.jsx("span",{className:"text-errorBase",children:t.errorMessage})]},b))})})},ie=()=>{const c={schoolNameValidations:Y,schoolAddressValidations:q,phoneNumberValidations:$,startMemberValidations:H,endMemberValidations:z},{selectedSchoolUUID:i,setVisibleModal:o,visibleModal:x,setIsTableLoading:p,setIsRefreshPage:u}=m.useContext(E),[v,l]=m.useState(!0),{formData:r,setFormData:n}=Q({schoolValidations:c}),[h,I]=m.useState(!0),y=m.useCallback(()=>{o(0),d.destroyAll()},[o]),N=(a,s)=>{n(g=>{const j=g.map(S=>{const{errorMessage:C,isError:w}=A(S.validations,a,s);return S.name==s?{...S,isError:w,value:a,errorMessage:C}:S});return I(!V(r,j)),j})},M=a=>{const{name:s,value:g}=a.target;n(j=>{const S=j.map(C=>{const{errorMessage:w,isError:k}=A(C.validations,g,s),W=s==="phone_number"?F(g):g;return C.name==s?{...C,value:W,errorMessage:w,isError:k}:C});return I(!V(r,S)),S})},t=async()=>{try{p(!0);const a=r.reduce((s,g)=>{const{name:j,value:S,type:C}=g;if(C==="date")s[j]=U(S).format("YYYY-MM-DD");else{const w=j==="phone_number"?O(S):S;s[j]=w}return s},{});await _.updateSchoolByUUID(i,a),d.success({title:"Update School",content:"Data added successfully!",onOk:y,centered:!0})}catch{d.error({title:"Error updating school",content:"Failed to update school",centered:!0,onOk:y})}finally{u(a=>!a),p(!1)}},b=a=>{a.preventDefault();let s=0;if(r.forEach(g=>{g.isError||s++}),s!==r.length)return!1;d.info({title:"Update School",content:"Are you sure to make a change?",centered:!0,okCancel:"Cancel",onOk:t})},D=a=>{a.preventDefault(),d.warning({title:"Update School",content:"Are you sure you want to exit? The data will not be saved.",okCancel:!0,centered:!0,onOk:y,width:500})},f=m.useCallback(async()=>{try{l(!0);const a=await _.getSchoolByUUID(i);if(a){const{school_name:s,school_address:g,phone_number:j,start_member:S,end_member:C}=a;n(w=>w.map(k=>{switch(k.name){case"school_name":return{...k,value:s};case"school_address":return{...k,value:g};case"phone_number":return{...k,value:F(j)};case"start_member":return{...k,value:U(S)};case"end_member":return{...k,value:U(C)};default:return k}}))}}catch{d.error({title:"Data not found",content:"school data not valid, please try again",onOk:y})}finally{l(!1)}},[l,y,i,n]);return m.useEffect(()=>{f()},[f]),e.jsx(d,{title:"Update School",open:x,onCancel:D,onOk:b,okButtonProps:{disabled:h},centered:!0,children:v?e.jsx("div",{className:"flex justify-center my-5",children:e.jsx(K,{spinning:!0,indicator:e.jsx(X,{style:{fontSize:24},spin:!0})})}):e.jsx("form",{className:"flex flex-col gap-3",children:r.map((a,s)=>a.type=="date"?e.jsxs(T,{direction:"vertical",className:"w-full text-black/90",children:[e.jsxs("label",{htmlFor:a.name,children:[e.jsx("span",{className:"text-errorHover",children:"*"})," ",a.label]}),e.jsx(L,{className:"w-full text-black/90",format:"YYYY/MM/DD",name:a.name,defaultValue:a.value,placeholder:a.placeholder,onChange:(g,j)=>N(j,a.name),required:!0}),a.errorMessage&&e.jsx("span",{className:"text-errorBase",children:a.errorMessage})]},s):e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("h3",{className:"text-lg text-black/0.88",children:[e.jsx("span",{className:"text-errorHover",children:"*"})," ",a.label]}),e.jsx(B,{type:"text",id:a.name,name:a.name,placeholder:a.placeholder,value:a.value,onChange:M}),a.errorMessage&&e.jsx("span",{className:"text-errorBase",children:a.errorMessage})]},s))})})},he=(c,i)=>[{title:"No",dataIndex:"id",key:"id"},{title:"Name",dataIndex:"schoolName",key:"schoolName"},{title:"Start",dataIndex:"startDate",key:"startDate"},{title:"End",dataIndex:"endDate",key:"endDate"},{title:"Action",dataIndex:"actions",key:"actions",render:(o,x)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(P,{label:"See",type:"success",icon:e.jsx(Z,{}),onClick:()=>c(3,x)}),e.jsx(P,{label:"Edit",type:"primary",icon:e.jsx(ee,{}),onClick:()=>c(2,x)}),e.jsx(P,{label:"Delete",type:"danger",icon:e.jsx(ae,{}),onClick:()=>{d.error({title:"Delete School Data",content:"Are you sure you want to delete this data?.",centered:!0,okCancel:!0,onOk:()=>i(x)})}})]})}],me=()=>{const{currentPage:c,rowsPerPage:i,setCurrentPage:o,totalPages:x,totalData:p}=m.useContext(E),u=l=>{o(l)},v=(l,r,n,h)=>n==="prev"?l===1?e.jsx("a",{className:"text-black/0.25",children:"Previous"}):e.jsx("a",{className:"text-primary",onClick:()=>u(l-1),children:"Previous"}):n==="next"?l===r?e.jsx("a",{className:"text-black/0.25",children:"Next"}):e.jsx("a",{className:"text-primary",onClick:()=>u(l+1),children:"Next"}):h;return e.jsx(te,{align:"center",className:"mt-10",itemRender:(l,r,n)=>v(c,x,r,n),onChange:l=>u(l),defaultCurrent:1,current:c,total:p,pageSize:i})},xe=()=>{const{setVisibleModal:c,setSelectedSchoolUUID:i,schoolData:o,tableErrorMessage:x,isTableLoading:p,setIsTableLoading:u,setCurrentPage:v,isRefreshPage:l,setIsRefreshPage:r,getAllSchools:n}=m.useContext(E);m.useEffect(()=>{try{n()}catch{d.error({title:"Error fetching school data",content:"Failed to fetch school data",centered:!0})}},[n,l]);const h=async y=>{try{u(!0),await _.deleteSchoolByUUID(y.uuid),d.success({title:"Delete School Data",content:"Data deleted sucessfuly!",centered:!0})}catch{d.error({title:"Data not found",content:"school data not found",centered:!0})}finally{u(!1),v(1),r(N=>!N)}},I=(y,N={})=>{const M=N.uuid?N.uuid:null;i(M),c(y)};return x?e.jsx("div",{className:"flex w-full justify-center mt-5",children:e.jsx("span",{className:"text-red-500",children:x})}):e.jsxs("div",{children:[e.jsx(se,{columns:he(I,h),dataSource:o,bordered:!0,pagination:!1,loading:p}),e.jsx(me,{})]})},{Search:pe}=B,ge=()=>{const{setRowPerPage:c,visibleModal:i,setVisibleModal:o,setSearchSchool:x,setCurrentPage:p}=m.useContext(E),u=[{value:"5",label:"5"},{value:"10",label:"10"},{value:"15",label:"15"},{value:"20",label:"20"},{value:"50",label:"50"}],v=re.debounce(async r=>{p(1),x(r)},300),l=[{title:"School Management",path:"/school-management"}];return e.jsxs("section",{className:"section",children:[e.jsx(oe,{pageName:"School Dashboard",subPages:l}),e.jsx(le,{toastStyle:{width:"200%",borderColor:"#FFA39E",backgroundColor:"#FFF1F0",color:"#000",fontSize:"12px",borderRadius:"8px",borderWidth:"1px",borderStyle:"solid",padding:"16px"}}),e.jsxs("div",{className:"m-5 bg-white p-10 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(pe,{placeholder:"Search",className:"w-1/4",onSearch:r=>v(r),onChange:r=>v(r.target.value),enterButton:!0}),e.jsx(P,{icon:e.jsx(ne,{}),type:"primary",label:"Create School",iconPosition:"end",className:"py-5 px-5",onClick:()=>o(1)})]}),e.jsxs("div",{className:"my-6 flex gap-3 items-center",children:[e.jsx("span",{className:"text-black",children:"Show"}),e.jsx(ce,{defaultValue:"5",className:"w-15",options:u,onChange:r=>{p(1),c(r)}}),e.jsx("span",{children:"Entries"})]}),e.jsx(xe,{})]}),i===1?e.jsx(de,{}):i===2?e.jsx(ie,{}):i===3?e.jsx(ue,{}):null]})};export{ge as default};
